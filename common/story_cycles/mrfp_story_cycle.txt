mrfp_recruitment_cycle = {
    on_setup = {
        # Core recruitment settings
        set_variable = {
            name = mrfp_threshold_enabled
            value = 0
        }
        set_variable = {
            name = mrfp_prowess_threshold
            value = 16
        }

        # Release options configuration
        set_variable = { name = mrfp_RELEASE_DEMAND_CONVERSION value = yes }
        set_variable = { name = mrfp_RELEASE_RECRUIT value = yes }
        set_variable = { name = mrfp_RELEASE_RENOUNCE_CLAIMS value = no }
        set_variable = { name = mrfp_RELEASE_BANISH value = no }
        set_variable = { name = mrfp_RELEASE_GAIN_HOOK value = no }
        set_variable = { name = mrfp_RELEASE_TAKE_VOWS value = no }
        set_variable = { name = mrfp_RELEASE_AS_EXECUTIONER value = no }
        set_variable = { name = mrfp_RELEASE_DISFIGURE value = no }
        set_variable = { name = mrfp_RELEASE_BLIND value = no }
        set_variable = { name = mrfp_RELEASE_CASTRATE value = no }

        # Additional tracking variables
        set_variable = { name = mrfp_total_recruited value = 0 }
        set_variable = { name = mrfp_total_ransomed value = 0 }
    }

    on_end = {
		# Remove auto flags
		story_owner = {
			remove_character_flag = enable_auto_mrfp
			remove_character_flag = enable_auto_mrfp_ransom
		}
		end_story = yes
    }

    on_owner_death = {
        # Transfer all settings to primary heir
		story_owner = {
			# if = {
            #     limit = {  has_character_flag = enable_auto_mrfp }
            #     story_owner.primary_heir = { add_character_flag = enable_auto_mrfp }
            # }
            # if = {
            #     limit = { has_character_flag = enable_auto_mrfp_ransom }
            #     story_owner.primary_heir = { add_character_flag = enable_auto_mrfp_ransom }
            # }

        }

		debug_log = "Total prisoners recruited: [THIS.Var('mrfp_total_recruited').GetValue]"
		debug_log = "Total prisoners ransomed: [THIS.Var('mrfp_total_ransomed').GetValue]"

        # story_owner.primary_heir = {
        #     # Transfer auto flags
		# 	# [23:46:10][E][jomini_eventtarget.cpp:307]: Invalid scope types for event target link, link: story_owner at file: common/story_cycles/mrfp_story_cycle.txt line: 105 (mrfp_recruitment_cycle:on_owner_death)
		# 	# [23:46:10][E][jomini_eventtarget.cpp:307]: Invalid scope types for event target link, link: story_owner at file: common/story_cycles/mrfp_story_cycle.txt line: 109 (mrfp_recruitment_cycle:on_owner_death)
        #     # if = {
        #     #     limit = { story_owner = { has_character_flag = enable_auto_mrfp } }
        #     #     add_character_flag = enable_auto_mrfp
        #     # }
        #     # if = {
        #     #     limit = { story_owner = { has_character_flag = enable_auto_mrfp_ransom } }
        #     #     add_character_flag = enable_auto_mrfp_ransom
        #     # }

        # }

		#Transfer ownership
		make_story_owner = story_owner.primary_heir

        #end_story = yes
    }

    # # Montlhly recruitment cycle
    # effect_group = {
    #     months = 1

    #     trigger = {
    #         has_character_flag = enable_auto_mrfp
    #     }

    #     triggered_effect = {
    #         trigger = {
    #             any_prisoner = {
    #                 prowess >= story_owner.var:mrfp_prowess_threshold
    #             }
    #         }
    #         effect = {
    #             every_prisoner = {
    #                 limit = {
    #                     prowess >= story_owner.var:mrfp_prowess_threshold
    #                 }
    #                 mrfp_every_prisoner_effect = {
    #                     MRFPROOT = story_owner
    #                     MRFPTHIS = this
    #                 }
                    
    #                 # Update recruitment counter
    #                 story_owner = {
    #                     change_variable = {
    #                         name = mrfp_total_recruited
    #                         add = 1
    #                     }
    #                 }
    #             }
    #         }
    #     }
    # }

    # # Monthly ransom cycle
    # effect_group = {
    #     months = 1

    #     trigger = {
    #         has_character_flag = enable_auto_mrfp_ransom
    #     }

    #     triggered_effect = {
    #         trigger = {
    #             any_prisoner = {
    #                 # Add specific ransom conditions if needed
    #                 always = yes
    #             }
    #         }
    #         effect = {
    #             every_prisoner = {
    #                 mrfp_ransom_every_prisoner_effect = {
    #                     MRFPROOT = story_owner
    #                     MRFPTHIS = this
    #                 }
                    
    #                 # Update ransom counter
    #                 story_owner = {
    #                     change_variable = {
    #                         name = mrfp_total_ransomed
    #                         add = 1
    #                     }
    #                 }
    #             }
    #         }
    #     }
    # }

    # # # Additional periodic checks and maintenance
    # # effect_group = {
    # #     years = 1

    # #     trigger = {
    # #         var:mrfp_threshold_enabled = 1
    # #     }

    # #     triggered_effect = {
    # #         trigger = {
    # #             # Any additional periodic maintenance conditions
    # #             always = yes
    # #         }
    # #         effect = {
    # #             # Periodic maintenance or logging
    # #             if = {
    # #                 limit = { 
    # #                     NOT = { has_character_flag = enable_auto_mrfp }
    # #                     var:mrfp_total_recruited > 0
    # #                 }
    # #                 add_character_flag = enable_auto_mrfp
    # #             }
    # #         }
    # #     }
    # # }
}