mrfp_is_loaded_sgui = {
  scope = character
  is_shown = {
    has_global_variable = mrfp_is_loaded
  }
  effect = {
    mrfp_start_story_if_not_exist = yes

    #save scopes like in story so the scripted effects works
    save_scope_as = the_story_owner 
    root.var:mrfp_story = {
      save_scope_as = the_story
    }
    
    #Prowess threshold enabled
    if = {
      limit = {
        scope:the_story.var:mrfp_threshold_enabled = yes
        any_prisoner = {
            prowess >= scope:the_story.var:mrfp_prowess_threshold
            is_ruler = no
        }
      }
      every_prisoner = {
        limit = {
            prowess >= scope:the_story.var:mrfp_prowess_threshold
            is_ruler = no
        }
        save_scope_as = the_story_prisoner
        mrfp_is_at_war_with_targets_liege_story = yes

        mrfp_release_all_unblocked_prisoners = yes
      }
      #temp set var for scripted effect to work
      set_variable = {
        name = mrfp_total_recruited_current
        value = scope:the_story.var:mrfp_total_recruited_current
      }
      mrfp_send_amout_people_released_message = yes
      remove_variable = mrfp_total_recruited_current
      
      scope:the_story = {
        mrfp_update_recruitment_counter = yes
      }
    }

    ###
  # #Prowess threshold disabled
  # triggered_effect = {
  #     trigger = {
  #         mrfp_threshold_enabled = no
  #     }
  #     effect = {
  #         save_scope_as = the_story
  #         story_owner = {
  #             save_scope_as = the_story_owner
  #             every_prisoner = {
  #                 limit = {
  #                     is_ruler = no
  #                 }
  #                 save_scope_as = the_story_prisoner
  #                 mrfp_is_at_war_with_targets_liege_story = yes

  #                 mrfp_release_all_unblocked_prisoners = yes
  #             }
              
  #             mrfp_send_amout_people_released_message = yes
  #         }

  #         # Update recruitment counter
  #         mrfp_update_recruitment_counter = yes
  #     }
  # }

    ##old code
    # every_prisoner = {
    #   mrfp_every_prisoner_effect = {
    #     MRFPROOT = root
    #     MRFPTHIS = this
    #   }
    # }
  }
}
mrfp_is_loaded_sgui_ransom = {
  scope = character
  is_shown = {
    has_global_variable = mrfp_is_loaded
  }
  effect = {
    every_prisoner = {
      mrfp_ransom_every_prisoner_effect = {
        MRFPROOT = root
        MRFPTHIS = this
      }
    }
  }
}