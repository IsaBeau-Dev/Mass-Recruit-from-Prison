# mrfp_is_loaded_sgui_using_interaction = {
#   scope = character
#   is_shown = {
#       #exists = global_var:mrfp_is_loaded
#     has_global_variable = mrfp_is_loaded
#   }
#   is_valid = {
#       #exists = global_var:mrfp_is_loaded
#     has_global_variable = mrfp_is_loaded
#   }
#   effect = {
#     debug_log = "Startup PRISONER RELEASE"
#     if = {
#       limit = {
#           has_prisoners = yes
#       }
#       debug_log = "Startup PRISONER RELEASE has prisoners"
#       every_prisoner = {
#         # limit = {
#         #   save_temporary_scope_as = mrfp_the_prisoner
#         #   #NOT = {prev.faith = this.faith}
#         #   root = { # prev is the ruler
#         #     is_character_interaction_valid = {
#         #       interaction = mrfp_release_from_prison_interaction
#         #       recipient = scope:mrfp_the_prisoner # prev is back to being the prisoner
#         #     }
#         #   }
#         #   #is_landed = no
#         #   #is_ruler = no
#         # }
#       debug_log_scopes = yes
#       save_scope_as = mrfp_global_the_prisoner
#       debug_log = "PRISONER RELEASE :- [THIS.Char.GetNameNoTooltip]"
#         run_interaction = {
#           interaction = mrfp_release_from_prison_interaction2
#           actor = root # prev is the ruler
#           #recipient = this # this is the prisoner
#           recipient = scope:mrfp_global_the_prisoner
#           execute_threshold = accept
#         }
#       }
#     }
#   }
# }
mrfp_is_loaded_sgui = {
  scope = character
  is_shown = {
      #exists = global_var:mrfp_is_loaded
    has_global_variable = mrfp_is_loaded
  }
  is_valid = {
      #exists = global_var:mrfp_is_loaded
    has_global_variable = mrfp_is_loaded
  }
  effect = {
    debug_log = "Startup PRISONER RELEASE"
    if = {
      limit = {
          has_prisoners = yes
      }
      debug_log = "Startup PRISONER RELEASE has prisoners"
      every_prisoner = {
        if = {
          limit = {
            #is_imprisoned_by = root
            NOT = { has_character_flag = is_being_tortured }
            is_ruler = no
          }
          save_scope_as = mrfp_global_the_prisoner
          ###Recruit
          #loyal servant
          if = {
            limit = { root = { culture = { has_cultural_parameter = can_recruit_prisoners_easily } } }
            add_opinion = {
              modifier = loyal_servant
              target = root
            }
            root = {
              if = {
                limit = {
                  can_add_hook = {
                      target = scope:mrfp_global_the_prisoner
                      type = loyalty_hook
                  }
                }
                add_hook = {
                  type = loyalty_hook
                  target = scope:mrfp_global_the_prisoner
                }
              }
            }
          }
          #demanded recruitmemt opinion
          else = {
            add_opinion = {
              modifier = demanded_recruitment
              target = root
            }
          }
          #communal possessions
          if = {
            limit = {
              AND = {
                root.faith = {
                    has_doctrine = tenet_communal_possessions
                }
                has_trait = peasant_leader
              }
            }
            root = { add_piety = medium_piety_gain }
          }
          #release from prison and add to court
          release_from_prison = yes
          root = {
              add_courtier = scope:mrfp_global_the_prisoner
          }
          ##testing
          if = {
            limit = {this.mrfp_accept > 0}
            debug_log = "Super Nice"
          }
        }
        
        
        #Demand Conversion
        if = {
          limit = {
            OR = {
              NOT = {this.faith = root.faith }
              AND = {
                  is_landed = yes
                  is_vassal_or_below_of = root
                  NOT = {this.faith = root.faith }
              }
            }
            ###
            NOT = {
              AND = {
                  exists = this.faith.religious_head
                  this.faith.religious_head = this
              }
            }
            #########
            NAND = {
              exists = this.faith
              this.faith = {
                  any_faith_holy_order = { leader = this }
              }
            }
            ############
          }

          #demand_conversion_interaction_effect = yes
          #this.set_faith = root.faith
          set_character_faith = root.faith
          add_opinion = {
              modifier = demanded_my_conversion_opinion
              target = root
          }
        }
          
          
          
        ###remove some flags
        if = {
          limit = { has_character_modifier = allowed_to_go_outside }
          remove_character_modifier = allowed_to_go_outside
        }
        if = {
          limit = { has_character_modifier = moldy_gruel_diet }
          remove_character_modifier = moldy_gruel_diet
        }
      }
    }
  }
}





############old
# every_prisoner = {
#     if = {
#         limit = {
#             #is_imprisoned_by = root
#             NOT = { has_character_flag = is_being_tortured }
#             is_ruler = no
#          }
#
#
#
#         #  ###Recruit
#         #  if = {
#         #          limit = {
#         #              root = {
#         #                  culture = {
#         #                      has_cultural_parameter = can_recruit_prisoners_easily
#         #                  }
#         #              }
#         #          }
#         #          add_opinion = {
#         #              modifier = loyal_servant
#         #              target = root
#         #          }
#         #          root = {
#         #              if = {
#         #                  limit = {
#         #                      can_add_hook = {
#         #                          target = prev
#         #                          type = loyalty_hook
#         #                      }
#         #                  }
#         #                  add_hook = {
#         #                      type = loyalty_hook
#         #                      target = prev
#         #                  }
#         #              }
#         #          }
#         #      }
#         #      else = {
#         #          add_opinion = {
#         #              modifier = demanded_recruitment
#         #              target = root
#         #          }
#         #      }
#         #      if = {
#         #          limit = {
#         #              AND = {
#         #                  root.faith = {
#         #                      has_doctrine = tenet_communal_possessions
#         #                  }
#         #                  has_trait = peasant_leader
#         #              }
#         #          }
#         #          root = {
#         #              add_piety = medium_piety_gain
#         #          }
#         #      }
#         #      # root = {
#         #      #     add_courtier = prev
#         #      # }
#         #      root.add_courtier = this
#         #  }
#         #
#         #
#         # #Demand Conversion
#         # if = {
#         #     limit = {
#         #         OR = {
#         #             NOT = {this.faith = root.faith }
#         #             AND = {
#         #                 is_landed = yes
#         #                 is_vassal_or_below_of = root
#         #                 NOT = {this.faith = root.faith }
#         #             }
#         #         }
#         #         ###
#         #         NOT = {
#         #             AND = {
#         #                 exists = this.faith.religious_head
#         #                 this.faith.religious_head = this
#         #             }
#         #         }
#         #         #########
#         #         NAND = {
#         #             exists = this.faith
#         #             this.faith = {
#         #                 any_faith_holy_order = { leader = this }
#         #             }
#         #         }
#         #         ############
#         #     }
#         #     #demand_conversion_interaction_effect = yes
#         #     set_faith = root.faith
#         #     add_opinion = {
#         #         modifier = demanded_my_conversion_opinion
#         #         target = root
#         #     }
#         # }
#         #
#         #
#         #
#         # ###remove some flags
#         # if = {
#         #     limit = { has_character_modifier = allowed_to_go_outside }
#         #     remove_character_modifier = allowed_to_go_outside
#         # }
#         # if = {
#         #     limit = { has_character_modifier = moldy_gruel_diet }
#         #     remove_character_modifier = moldy_gruel_diet
#         # }
#
#
#     }
# }
#########
# ai_accept = {
#     base = 0
#     modifier = {
#         add = 100
#         desc = "WANTS_FREEDOM_REASON"
#     }
#     modifier = {
#         trigger = {
#             scope:recipient = { ai_zeal <= 20 }
#             scope:demand_conversion = yes
#         }
#         add = -20
#         desc = "CONVERSION_NEGATIVE_REASON"
#     }
#     modifier = {
#         trigger = {
#             scope:recipient = { ai_zeal > 20 }
#             scope:demand_conversion = yes
#         }
#         add = {
#             value = ai_zeal
#             if = {
#                 limit = {
#                     scope:recipient.faith = {
#                         faith_hostility_level = {
#                             target = scope:actor.faith
#                             value = faith_astray_level
#                         }
#                     }
#                 }
#                 multiply = -1
#             }
#             else = {
#                 multiply = -2
#             }
#         }
#         desc = "CONVERSION_NEGATIVE_REASON"
#     }
#     modifier = {
#         add = -25
#         trigger = {
#             scope:renounce_claims = yes
#             ai_greed < 0
#         }
#         desc = "RENOUNCE_CLAIMS_REASON"
#     }
#     modifier = {
#         add = -50
#         trigger = {
#             scope:renounce_claims = yes
#             ai_greed >= 0
#             ai_greed < 26
#         }
#         desc = "RENOUNCE_CLAIMS_REASON"
#     }
#     modifier = {
#         add = -50
#         trigger = {
#             scope:become_executioner = yes
#             # Sadists don't care about becoming an executioner
#             NOR = {
#                 has_trait = sadistic
#                 has_trait = callous
#             }
#         }
#         desc = "BECOME_EXECUTIONER_REASON"
#     }
#     modifier = {
#         add = -75
#         trigger = {
#             scope:renounce_claims = yes
#             ai_greed >= 26
#             ai_greed < 51
#         }
#         desc = "RENOUNCE_CLAIMS_REASON"
#     }
#     modifier = {
#         add = -95
#         trigger = {
#             scope:renounce_claims = yes
#             ai_greed >= 51
#         }
#         desc = "RENOUNCE_CLAIMS_REASON"
#     }
#     modifier = {
#         add = -50
#         trigger = {
#             scope:banish = yes
#         }
#         NOT = {
#             scope:actor = {
#                 has_imprisonment_reason = scope:recipient
#                 culture = { has_cultural_parameter = vassals_more_likely_accept_punishments }
#             }
#         }
#         desc = "BANISH_NEGATIVE_REASON"
#     }
#     modifier = { # Legalistic tradition
#         add = legalistic_vassal_punishment_acceptance
#         trigger = {
#             scope:banish = yes
#         }
#         scope:actor = {
#             has_imprisonment_reason = scope:recipient
#             culture = { has_cultural_parameter = vassals_more_likely_accept_punishments }
#         }
#         desc = tradition_legalistic_name
#     }
#     modifier = {
#         add = {
#             value = -50
#             if = {
#                 limit = {
#                     scope:recipient = {
#                         ai_vengefulness > 0
#                     }
#                 }
#                 subtract = ai_vengefulness
#             }
#         }
#         trigger = {
#             scope:gain_hook = yes
#         }
#         desc = "GAIN_HOOK_NEGATIVE_REASON"
#     }
#     modifier = {
#         add = -30
#         trigger = {
#             scope:take_vows = yes
#         }
#         desc = "TAKE_VOWS_NEGATIVE_REASON"
#     }
#     modifier = {
#         add = -10
#         trigger = {
#             scope:recruit = yes
#             NOT = {
#                 scope:actor = {
#                     culture = {
#                         has_cultural_parameter = can_recruit_prisoners_easily
#                     }
#                 }
#             }
#         }
#         desc = "RECRUITMET_NEGATIVE_REASON"
#     }
#     # Struggle
#     modifier = {
#         trigger = {
#             scope:demand_conversion = no
#             scope:renounce_claims = no
#             scope:banish = no
#             scope:gain_hook = no
#             scope:take_vows = no
#             scope:recruit = no
#         }
#         scope:recipient = {
#             any_character_struggle = {
#                 involvement = involved
#             }
#         }
#         scope:actor = {
#             any_character_struggle = {
#                 involvement = involved
#             }
#         }
#         add = {
#             value = 0
#             if = {
#                 limit = {
#                     scope:recipient = {
#                         any_character_struggle = {
#                             phase_has_catalyst = catalyst_release_important
#                         }
#                         has_character_flag = agenda_towards_escalation
#                     }
#                 }
#                 add = -100
#             }
#             else_if = {
#                 limit = {
#                     scope:recipient = {
#                         any_character_struggle = {
#                             phase_has_catalyst = catalyst_release_important
#                         }
#                     }
#                 }
#                 add = 200
#             }
#         }
#     }
# }
###########
